<!DOCTYPE html>
<html>
<head>
<title>üíå Love Scratch Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;}

body{
  margin:0;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  font-family:"Comic Sans MS", cursive;
  background:linear-gradient(135deg,#7f00ff,#e100ff,#ff4fd8);
  text-align:center;
  padding:10px;
  color:white;
}

/* Card container */
#card{
  position:relative;
  width:95%;
  max-width:320px;
  height:400px;
  border-radius:25px;
  background:rgba(255,255,255,0.2);
  border:2px solid rgba(255,255,255,0.5);
  box-shadow:0 10px 30px rgba(0,0,0,0.3);
  overflow:hidden;
}

/* Hidden message */
#note{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  font-size:22px;
  font-weight:bold;
  text-align:center;
  opacity:0;
  transition:0.5s;
  z-index:1;
}

/* Canvas */
#scratch{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  z-index:2;
  touch-action:none;
}

/* Counter */
#counter{
  margin-bottom:5px;
  font-size:16px;
}
</style>
</head>

<body>

<h2>Scratch to Reveal My Love üíï</h2>
<div id="counter">1 / 4</div>

<div id="card">
  <div id="note"></div>
  <canvas id="scratch"></canvas>
</div>

<script>
const notes = [
"Please don‚Äôt forget my birthday üòò",
"You are my sunshine and my happiness ‚òÄÔ∏è",
"I want to be with you forever üíç",
"I LOVE YOU SO MUCH ‚ù§Ô∏è"
];

let index = 0;
const noteDiv = document.getElementById("note");
const canvas = document.getElementById("scratch");
const ctx = canvas.getContext("2d");
const counter = document.getElementById("counter");

/* FIX CANVAS SIZE */
function resizeCanvas(){
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

/* Load card */
function loadCard(){
  noteDiv.innerHTML = "üíú<br>" + notes[index] + "<br>üíú";
  noteDiv.style.opacity = 0;

  ctx.globalCompositeOperation="source-over";
  ctx.fillStyle="#9b00ff";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.font="120px serif";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.fillText("üíú",canvas.width/2,canvas.height/2);

  ctx.globalCompositeOperation="destination-out";

  counter.innerText=(index+1)+" / "+notes.length;
}
loadCard();

/* Scratch logic */
let drawing=false;

function getPos(e){
  const rect=canvas.getBoundingClientRect();
  if(e.touches){
    return {
      x:e.touches[0].clientX-rect.left,
      y:e.touches[0].clientY-rect.top
    };
  }
  return {x:e.clientX-rect.left,y:e.clientY-rect.top};
}

function scratch(e){
  if(!drawing) return;
  e.preventDefault();
  const p=getPos(e);

  ctx.beginPath();
  ctx.arc(p.x,p.y,45,0,Math.PI*2);
  ctx.fill();
}

/* Events */
canvas.addEventListener("mousedown",()=>drawing=true);
canvas.addEventListener("mouseup",()=>{drawing=false;check();});
canvas.addEventListener("mousemove",scratch);

canvas.addEventListener("touchstart",()=>drawing=true);
canvas.addEventListener("touchend",()=>{drawing=false;check();});
canvas.addEventListener("touchmove",scratch);

/* Check scratched area */
function check(){
  const pixels=ctx.getImageData(0,0,canvas.width,canvas.height).data;
  let cleared=0;
  for(let i=3;i<pixels.length;i+=4){
    if(pixels[i]===0) cleared++;
  }

  if(cleared > pixels.length/5){
    noteDiv.style.opacity=1;

    setTimeout(()=>{
      index++;
      if(index>=notes.length){
        window.location.href="final.html";
      }else{
        loadCard();
      }
    },2000);
  }
}
</script>

</body>
</html>
