<!DOCTYPE html>
<html>
<head>
<title>üíå Love Scratch Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;}

body{
  margin:0;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  font-family:"Comic Sans MS", cursive;
  background:linear-gradient(135deg,#7f00ff,#e100ff,#ff4fd8);
  text-align:center;
  padding:10px;
  overflow:hidden;
  color:white;
}

/* Floating hearts */
.float{
  position:fixed;
  bottom:-50px;
  animation:floatUp 8s linear forwards;
  opacity:0.7;
  z-index:-1;
}
@keyframes floatUp{
  to{transform:translateY(-120vh);opacity:0;}
}

/* Card */
#card{
  position:relative;
  width:95%;
  max-width:360px;
  height:450px;
  border-radius:30px;
  backdrop-filter:blur(12px);
  background:rgba(255,255,255,0.2);
  border:2px solid rgba(255,255,255,0.5);
  box-shadow:0 15px 40px rgba(0,0,0,0.3);
  overflow:hidden;
  margin-top:20px;
}

/* Love Message */
#note{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  font-size:27px;
  color:white;
  font-weight:bold;
  text-align:center;
  padding:20px;
  opacity:0;
  transform:scale(0.8);
  transition:0.5s;
  z-index:1;
}

#note span{
  font-size:40px;
  animation:pulse 1s infinite alternate;
}

@keyframes pulse{
  from{transform:scale(1);}
  to{transform:scale(1.2);}
}

/* Scratch Layer */
canvas{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  z-index:2;
}

/* Counter */
#counter{
  font-size:18px;
  margin-top:5px;
}

/* Music Button */
#musicBtn{
  margin-top:15px;
  padding:10px 25px;
  border:none;
  border-radius:25px;
  background:#b000ff;
  color:white;
  font-size:16px;
  cursor:pointer;
  box-shadow:0 5px 15px rgba(0,0,0,0.3);
}
#musicBtn:hover{transform:scale(1.1);}
</style>
</head>

<body>

<h2>Scratch to Reveal My Love üíï</h2>
<div id="counter">1 / 4</div>

<div id="card">
  <div id="note"></div>
  <canvas id="scratch"></canvas>
</div>

<button id="musicBtn" onclick="toggleMusic()">üîä Music On / Off</button>

<audio id="bgMusic" loop>
  <source src="https://cdn.pixabay.com/audio/2022/03/10/audio_8d8a1c2f59.mp3" type="audio/mp3">
</audio>

<script>
/* LOVE MESSAGES */
const notes = [
"Please don‚Äôt forget my birthday üòò",
"You are my sunshine and my happiness ‚òÄÔ∏è",
"I want to be with you forever üíç",
"I LOVE YOU SO MUCH ‚ù§Ô∏è"
];

let index = 0;

const noteDiv = document.getElementById("note");
const canvas = document.getElementById("scratch");
const ctx = canvas.getContext("2d");
const counter = document.getElementById("counter");
const music = document.getElementById("bgMusic");

/* Resize canvas */
function resizeCanvas(){
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

/* Load Scratch Card */
function loadCard(){
  noteDiv.innerHTML = `<span>üíú</span><br>${notes[index]}<br><span>üíú</span>`;
  noteDiv.style.opacity = 0;
  noteDiv.style.transform = "scale(0.8)";

  ctx.globalCompositeOperation = "source-over";
  ctx.fillStyle = "#9b00ff";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.font = "150px serif";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText("üíú", canvas.width/2, canvas.height/2);

  ctx.globalCompositeOperation = "destination-out";

  counter.innerText = (index+1)+" / "+notes.length;
}
loadCard();

/* Scratch */
let drawing=false;

function scratch(e){
  if(!drawing) return;
  const rect = canvas.getBoundingClientRect();
  const x = (e.clientX || e.touches[0].clientX) - rect.left;
  const y = (e.clientY || e.touches[0].clientY) - rect.top;

  ctx.beginPath();
  ctx.arc(x,y,40,0,Math.PI*2);
  ctx.fill();
}

/* Mouse */
canvas.onmousedown=()=>drawing=true;
canvas.onmouseup=()=>{drawing=false;check();};
canvas.onmousemove=scratch;

/* Touch Mobile */
canvas.ontouchstart=()=>drawing=true;
canvas.ontouchend=()=>{drawing=false;check();};
canvas.ontouchmove=scratch;

/* Check scratch progress */
function check(){
  const pixels = ctx.getImageData(0,0,canvas.width,canvas.height).data;
  let cleared=0;

  for(let i=3;i<pixels.length;i+=4){
    if(pixels[i]===0) cleared++;
  }

  if(cleared > pixels.length/6){
    noteDiv.style.opacity=1;
    noteDiv.style.transform="scale(1)";

    setTimeout(()=>{
      index++;

      if(index >= notes.length){
        window.location.href = "final.html"; 
      } 
      else {
        loadCard();
      }

    },2000);
  }
}

/* Floating Hearts */
function floatItem(){
  const hearts=["üíú","üíñ","üíó","üíï"];
  const el=document.createElement("div");
  el.className="float";
  el.innerHTML=hearts[Math.floor(Math.random()*hearts.length)];
  el.style.left=Math.random()*100+"vw";
  el.style.fontSize=(20+Math.random()*40)+"px";
  el.style.animationDuration=(6+Math.random()*6)+"s";
  document.body.appendChild(el);
  setTimeout(()=>el.remove(),12000);
}
setInterval(floatItem,400);

/* Music Control */
function toggleMusic(){
  if(music.paused){
    music.play();
  }else{
    music.pause();
  }
}

/* Mobile autoplay fix */
document.body.addEventListener("click", ()=> music.play(), {once:true});
</script>

</body>
</html>
